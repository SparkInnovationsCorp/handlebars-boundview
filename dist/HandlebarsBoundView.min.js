class HandlebarsBoundView { constructor(e = "#app", t = null) { this.target = e, this.templatePath = t || this.constructor.name + ".html", this.template = null, this.register() } register() { this.onclickHandles = [], this.bindHandles = []; const e = this; Handlebars.registerHelper("eq", (function (e, t) { return e === t })), Handlebars.registerHelper("neq", (function (e, t) { return e !== t })), Handlebars.registerHelper("gt", (function (e, t) { return e > t })), Handlebars.registerHelper("lt", (function (e, t) { return e < t })), Handlebars.registerHelper("click", (function (t, n) { return "function" == typeof e[t] ? (e.onclickHandles.push({ fn: e[t].bind(e), redraw: "boolean" != typeof n || n, data: this }), `data-onclickhandler='${e.onclickHandles.length - 1}'`) : (console.error(`Error: Method ${t} does not exist on the class.`), "") })), Handlebars.registerHelper("bind", (function (t) { return e.bindHandles.push({ prop: t, data: this }), `data-bind='${e.bindHandles.length - 1}'` })), Handlebars.registerHelper("call", (function (t) { return "function" == typeof e[t] ? e[t].bind(e)(this) : (console.error(`Error: Method ${t} does not exist on the class.`), "") })) } loadTemplate(e) { this.template ? e() : fetch(this.templatePath).then((e => { if (!e.ok) throw new Error(`HTTP error! status: ${e.status}`); return e.text() })).then((t => { this.template = Handlebars.compile(t), e() })).catch((e => { console.error("Error: Could not load template " + this.templatePath + " " + e.message) })) } render() { this.onclickHandles = [], this.bindHandles = [], this.loadTemplate((() => { const e = this.template(this), t = document.querySelector(this.target); t ? t.innerHTML = e : console.error(`The target "${this.target}" could not be found.`), this.bindProps(), this.bindEvents() })) } bindEvents() { const e = this; document.querySelectorAll("[data-onclickhandler]").forEach((t => { const n = parseInt(t.getAttribute("data-onclickhandler"), 10), r = e.onclickHandles[n]; t.addEventListener("click", (function () { if (r.redraw) { const t = e.serialize(); r.fn(r.data); t !== e.serialize() && e.render() } else r.fn(r.data) })) })) } bindProps() { const e = this; document.querySelectorAll("[data-bind]").forEach((t => { const n = parseInt(t.getAttribute("data-bind"), 10), r = e.bindHandles[n]; var a = r.prop, s = null; a.startsWith("base.") ? (s = e, a = r.prop.substring(5)) : a.startsWith("this.") ? (s = r.data, a = r.prop.substring(5)) : s = r.data, "INPUT" === t.tagName || "SELECT" === t.tagName || "TEXTAREA" === t.tagName ? t.value = s[a] : t.textContent = s[a], t.addEventListener("change", (function () { s[a] = t.value, e.render() })) })) } serialize() { return JSON.stringify(this, (function (e, t) { if (!(["onclickHandles", "bindHandles", "target", "template", "templatePath"].indexOf(e) > -1)) return t })) } }